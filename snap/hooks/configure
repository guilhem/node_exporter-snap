#!/bin/sh -e

collectors="$(snapctl get collectors)"

for collector in $collectors; do
    if ! expr "$collector" : '^\w\+$' > /dev/null; then
        echo "\"$collector\" is not a valid collector" >&2
        exit 1
    fi
    flags="${flags} --collector.$collector"
done

no_collectors="$(snapctl get no-collectors)"

for no_collector in $no_collectors; do
    if ! expr "$no_collector" : '^\w\+$' > /dev/null; then
        echo "\"$no_collector\" is not a valid collector" >&2
        exit 1
    fi
    flags="${flags} --no-collector.$no_collector"
done

echo "$flags" > $SNAP_DATA/flags
snapctl restart node-exporter
